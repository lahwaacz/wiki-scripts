
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>ws.db.sql_types module &#8212; wiki-scripts 1.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/wiki-scripts.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ws.interlanguage package" href="ws.interlanguage.html" />
    <link rel="prev" title="ws.db.schema module" href="ws.db.schema.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-ws.db.sql_types">
<span id="ws-db-sql-types-module"></span><h1>ws.db.sql_types module<a class="headerlink" href="#module-ws.db.sql_types" title="Permalink to this headline">¶</a></h1>
<p>Custom types with automatic convertors.</p>
<dl class="simple">
<dt>Advantages of textual types:</dt><dd><ul class="simple">
<li><p>natural for the representation of textual (Unicode) data</p></li>
</ul>
</dd>
<dt>Disadvantages of textual types:</dt><dd><ul class="simple">
<li><p>subject to encoding and collation</p></li>
</ul>
</dd>
<dt>Advantages of binary types:</dt><dd><ul class="simple">
<li><p>complete control over the data representation and conversion to Python
objects</p></li>
<li><p>length is in bytes, so there is no storage overhead for ASCII-only data</p></li>
</ul>
</dd>
</dl>
<p>In MySQL, textual types (<code class="docutils literal notranslate"><span class="pre">*TEXT</span></code>, <code class="docutils literal notranslate"><span class="pre">*CHAR</span></code>) represent Unicode strings, but
all utf8 collations are case-insensitive: <a class="reference external" href="http://stackoverflow.com/a/4558736/4180822">http://stackoverflow.com/a/4558736/4180822</a>
On the other hand, binary types (<code class="docutils literal notranslate"><span class="pre">*BLOB</span></code>, <code class="docutils literal notranslate"><span class="pre">*BINARY</span></code>) are treated as
“byte strings”, i.e. ASCII text with binary collation.</p>
<p>In PostgreSQL, the binary type (bytea) does not represent “strings”, i.e. there
are much less operations and functions defined on bytea then in MySQL for
binary strings. By using the textual types, we also benefit from native
conversion functions in the sqlalchemy driver (e.g. psycopg2).</p>
<p>MediaWiki’s PostgreSQL schema uses <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> for just about everyting, i.e. no
<code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>. <a class="reference external" href="https://www.postgresql.org/docs/current/static/datatype-character.html">PostgreSQL manual</a> says that there is no performance difference
between <code class="docutils literal notranslate"><span class="pre">char(n)</span></code>, <code class="docutils literal notranslate"><span class="pre">varchar(n)</span></code> and <code class="docutils literal notranslate"><span class="pre">text</span></code>.</p>
<p>Also note that the MySQL limits are in <cite>bytes</cite>, whereas textual types are
measured in <cite>characters</cite>. Therefore we follow the PostgreSQL schema and use
<code class="docutils literal notranslate"><span class="pre">TEXT</span></code> instead of <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>.</p>
<dl class="py class">
<dt class="sig sig-object py" id="ws.db.sql_types.MWTimestamp">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">ws.db.sql_types.</span></span><span class="sig-name descname"><span class="pre">MWTimestamp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.MWTimestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.sqlalchemy.org/en/14/core/custom_types.html#sqlalchemy.types.TypeDecorator" title="(in SQLAlchemy v1.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.type_api.TypeDecorator</span></code></a></p>
<p>Convertor for TIMESTAMP handling infinite values.</p>
<p>Construct a <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code>.</p>
<p>Arguments sent here are passed to the constructor
of the class assigned to the <code class="docutils literal notranslate"><span class="pre">impl</span></code> class level attribute,
assuming the <code class="docutils literal notranslate"><span class="pre">impl</span></code> is a callable, and the resulting
object is assigned to the <code class="docutils literal notranslate"><span class="pre">self.impl</span></code> instance attribute
(thus overriding the class attribute of the same name).</p>
<p>If the class level <code class="docutils literal notranslate"><span class="pre">impl</span></code> is not a callable (the unusual case),
it will be assigned to the same instance attribute ‘as-is’,
ignoring those arguments passed to the constructor.</p>
<p>Subclasses can override this to customize the generation
of <code class="docutils literal notranslate"><span class="pre">self.impl</span></code> entirely.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ws.db.sql_types.MWTimestamp.impl">
<span class="sig-name descname"><span class="pre">impl</span></span><em class="property"> <span class="pre">=</span> <span class="pre">DateTime()</span></em><a class="headerlink" href="#ws.db.sql_types.MWTimestamp.impl" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ws.db.sql_types.MWTimestamp.process_bind_param">
<span class="sig-name descname"><span class="pre">process_bind_param</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.MWTimestamp.process_bind_param" title="Permalink to this definition">¶</a></dt>
<dd><p>Python -&gt; database</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ws.db.sql_types.MWTimestamp.process_result_value">
<span class="sig-name descname"><span class="pre">process_result_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.MWTimestamp.process_result_value" title="Permalink to this definition">¶</a></dt>
<dd><p>database -&gt; python</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ws.db.sql_types.SHA1">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">ws.db.sql_types.</span></span><span class="sig-name descname"><span class="pre">SHA1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.SHA1" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.sqlalchemy.org/en/14/core/custom_types.html#sqlalchemy.types.TypeDecorator" title="(in SQLAlchemy v1.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.type_api.TypeDecorator</span></code></a></p>
<p>Convertor for the SHA1 hashes.</p>
<p>In MediaWiki they are represented as a base36-encoded number in the database
and as a hexadecimal string in the API.</p>
<p>In both forms the encoded string has to be padded with zeros to fixed
length - 31 digits in base36, 40 digits in hex.</p>
<p>Construct a <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code>.</p>
<p>Arguments sent here are passed to the constructor
of the class assigned to the <code class="docutils literal notranslate"><span class="pre">impl</span></code> class level attribute,
assuming the <code class="docutils literal notranslate"><span class="pre">impl</span></code> is a callable, and the resulting
object is assigned to the <code class="docutils literal notranslate"><span class="pre">self.impl</span></code> instance attribute
(thus overriding the class attribute of the same name).</p>
<p>If the class level <code class="docutils literal notranslate"><span class="pre">impl</span></code> is not a callable (the unusual case),
it will be assigned to the same instance attribute ‘as-is’,
ignoring those arguments passed to the constructor.</p>
<p>Subclasses can override this to customize the generation
of <code class="docutils literal notranslate"><span class="pre">self.impl</span></code> entirely.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ws.db.sql_types.SHA1.impl">
<span class="sig-name descname"><span class="pre">impl</span></span><em class="property"> <span class="pre">=</span> <span class="pre">LargeBinary(length=31)</span></em><a class="headerlink" href="#ws.db.sql_types.SHA1.impl" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ws.db.sql_types.SHA1.process_bind_param">
<span class="sig-name descname"><span class="pre">process_bind_param</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.SHA1.process_bind_param" title="Permalink to this definition">¶</a></dt>
<dd><p>python -&gt; db</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ws.db.sql_types.SHA1.process_result_value">
<span class="sig-name descname"><span class="pre">process_result_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.SHA1.process_result_value" title="Permalink to this definition">¶</a></dt>
<dd><p>db -&gt; python</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ws.db.sql_types.JSONEncodedDict">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">ws.db.sql_types.</span></span><span class="sig-name descname"><span class="pre">JSONEncodedDict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.JSONEncodedDict" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.sqlalchemy.org/en/14/core/custom_types.html#sqlalchemy.types.TypeDecorator" title="(in SQLAlchemy v1.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.type_api.TypeDecorator</span></code></a></p>
<p>Represents an immutable structure as a JSON-encoded string.</p>
<p>Construct a <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code>.</p>
<p>Arguments sent here are passed to the constructor
of the class assigned to the <code class="docutils literal notranslate"><span class="pre">impl</span></code> class level attribute,
assuming the <code class="docutils literal notranslate"><span class="pre">impl</span></code> is a callable, and the resulting
object is assigned to the <code class="docutils literal notranslate"><span class="pre">self.impl</span></code> instance attribute
(thus overriding the class attribute of the same name).</p>
<p>If the class level <code class="docutils literal notranslate"><span class="pre">impl</span></code> is not a callable (the unusual case),
it will be assigned to the same instance attribute ‘as-is’,
ignoring those arguments passed to the constructor.</p>
<p>Subclasses can override this to customize the generation
of <code class="docutils literal notranslate"><span class="pre">self.impl</span></code> entirely.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="ws.db.sql_types.JSONEncodedDict.impl">
<span class="sig-name descname"><span class="pre">impl</span></span><a class="headerlink" href="#ws.db.sql_types.JSONEncodedDict.impl" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference external" href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.UnicodeText" title="(in SQLAlchemy v1.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.sqltypes.UnicodeText</span></code></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ws.db.sql_types.JSONEncodedDict.process_bind_param">
<span class="sig-name descname"><span class="pre">process_bind_param</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.JSONEncodedDict.process_bind_param" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a bound parameter value to be converted.</p>
<p>Subclasses override this method to return the
value that should be passed along to the underlying
<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code> object, and from there to the
DBAPI <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method.</p>
<p>The operation could be anything desired to perform custom
behavior, such as transforming or serializing data.
This could also be used as a hook for validating logic.</p>
<p>This operation should be designed with the reverse operation
in mind, which would be the process_result_value method of
this class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – Data to operate upon, of any type expected by
this method in the subclass.  Can be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>dialect</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code> in use.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ws.db.sql_types.JSONEncodedDict.process_result_value">
<span class="sig-name descname"><span class="pre">process_result_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ws.db.sql_types.JSONEncodedDict.process_result_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a result-row column value to be converted.</p>
<p>Subclasses should implement this method to operate on data
fetched from the database.</p>
<p>Subclasses override this method to return the
value that should be passed back to the application,
given a value that is already processed by
the underlying <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code> object, originally
from the DBAPI cursor method <code class="docutils literal notranslate"><span class="pre">fetchone()</span></code> or similar.</p>
<p>The operation could be anything desired to perform custom
behavior, such as transforming or serializing data.
This could also be used as a hook for validating logic.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – Data to operate upon, of any type expected by
this method in the subclass.  Can be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>dialect</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code> in use.</p></li>
</ul>
</dd>
</dl>
<p>This operation should be designed to be reversible by
the “process_bind_param” method of this class.</p>
</dd></dl>

</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/wiki-scripts.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">wiki-scripts</a></h1>










<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Writing new scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">API reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ws.html">ws package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="ws.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ws.ArchWiki.html">ws.ArchWiki package</a></li>
<li class="toctree-l4"><a class="reference internal" href="ws.checkers.html">ws.checkers package</a></li>
<li class="toctree-l4"><a class="reference internal" href="ws.client.html">ws.client package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="ws.db.html">ws.db package</a></li>
<li class="toctree-l4"><a class="reference internal" href="ws.interlanguage.html">ws.interlanguage package</a></li>
<li class="toctree-l4"><a class="reference internal" href="ws.parser_helpers.html">ws.parser_helpers package</a></li>
<li class="toctree-l4"><a class="reference internal" href="ws.utils.html">ws.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ws.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../modules.html">API reference</a><ul>
  <li><a href="ws.html">ws package</a><ul>
  <li><a href="ws.db.html">ws.db package</a><ul>
      <li>Previous: <a href="ws.db.schema.html" title="previous chapter">ws.db.schema module</a></li>
      <li>Next: <a href="ws.interlanguage.html" title="next chapter">ws.interlanguage package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014-2018, Jakub Klinkovský.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/ws/ws.db.sql_types.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/lahwaacz/wiki-scripts" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>